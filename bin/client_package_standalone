#!/bin/bash

###########################################################################
# Packaging script which creates standalone package.
#
# Usage:
#> bin/client_package_standalone <os>
#
# Package (specific OS: linux, darwin, windows):
#> bin/client_package_standalone linux
#
# Package (specific binary):
#> BINARY=build/client/mysterium_client_darwin_amd64 bin/client_package_standalone darwin

set -e

source bin/helpers/output.sh

OS=$1
if [ -z "$OS" ]; then
    print_error "Missing OS!"
    exit 1
fi
if [ "$OS" != "linux" ] && [ "$OS" != "darwin" ] && [ "$OS" != "windows" ]; then
    print_error "OS should be: linux, darwin, windows!"
    exit 1
fi

BINARY=${BINARY:="build/client/mysterium_client"}
DIR_BUILD="build/package"
PACKAGE_FILE="${DIR_BUILD}/`basename -s .exe ${BINARY}`.tar.gz"

# Put all files to package directory (to avoid preserving directory structure)
DIR_TEMP=`mktemp -d ${DIR_BUILD}/${tempname}.XXXXXX`
cp -p ${BINARY} ${DIR_TEMP}/mysterium_client
cp -rp "bin/common_package/" ${DIR_TEMP}/config
cp -rp "bin/client_package/config/${OS}/" ${DIR_TEMP}/config 2>/dev/null || true

# Tarball package directory
tar -zcv -f ${PACKAGE_FILE} -C ${DIR_TEMP} .
rm -rf ${DIR_TEMP}
